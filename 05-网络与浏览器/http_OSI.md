# OSI 七层模型与 TCP/IP 四层模型

> 网络协议分层架构详解

---

## 📚 目录

- [一、OSI 七层模型](#一osi-七层模型)
- [二、TCP/IP 四层模型](#二tcpip-四层模型)
- [三、模型对比](#三模型对比)
- [四、浏览器请求流程](#四浏览器请求流程)
- [五、面试常考点](#五面试常考点)

---

## 一、OSI 七层模型

### 1.1 模型概览

```
浏览器请求（HTTP/HTTPS）
       │
       ▼
┌───────────────────────────────┐
│  应用层 (7) - Application     │
│  提供网络服务、HTTP/HTTPS     │
└───────────────────────────────┘
       │
       ▼
┌───────────────────────────────┐
│  表示层 (6) - Presentation   │
│  数据编码/加密/解密           │
│  TLS/SSL 加密                 │
└───────────────────────────────┘
       │
       ▼
┌───────────────────────────────┐
│  会话层 (5) - Session          │
│  会话建立、维护和终止         │
│  WebSocket 会话管理           │
└───────────────────────────────┘
       │
       ▼
┌───────────────────────────────┐
│  传输层 (4) - Transport        │
│  TCP/UDP，端到端通信，可靠传输│
│  TCP 三次握手 / 四次挥手       │
└───────────────────────────────┘
       │
       ▼
┌───────────────────────────────┐
│  网络层 (3) - Network          │
│  IP 路由、寻址               │
│  数据包从源 IP 到目标 IP      │
└───────────────────────────────┘
       │
       ▼
┌───────────────────────────────┐
│  数据链路层 (2) - Data Link    │
│  MAC 地址，帧传输             │
│  局域网通信、交换机           │
└───────────────────────────────┘
       │
       ▼
┌───────────────────────────────┐
│  物理层 (1) - Physical         │
│  电缆、光纤、信号传输         │
└───────────────────────────────┘
       │
       ▼
        服务器接收请求
```

### 1.2 各层详解

#### 第 7 层：应用层（Application Layer）

**功能**：
- 提供网络服务接口
- 用户与网络的接口

**协议**：
- HTTP / HTTPS
- FTP
- SMTP
- DNS

**示例**：
```http
GET /index.html HTTP/1.1
Host: example.com
```

---

#### 第 6 层：表示层（Presentation Layer）

**功能**：
- 数据格式转换
- 数据加密/解密
- 数据压缩

**协议**：
- TLS / SSL（加密）
- JPEG、MPEG（数据格式）

**示例**：
- HTTPS 中的 TLS 加密
- 图片格式转换

---

#### 第 5 层：会话层（Session Layer）

**功能**：
- 建立、管理、终止会话
- 会话同步

**协议**：
- WebSocket
- RPC

**示例**：
```js
// WebSocket 会话管理
const ws = new WebSocket('wss://example.com');
ws.onopen = () => { /* 会话建立 */ };
ws.onclose = () => { /* 会话终止 */ };
```

---

#### 第 4 层：传输层（Transport Layer）

**功能**：
- 端到端通信
- 可靠传输
- 流量控制
- 拥塞控制

**协议**：
- **TCP**（可靠传输）
- **UDP**（不可靠传输）

**TCP 特点**：
- ✅ 可靠传输（确认机制）
- ✅ 有序传输
- ✅ 流量控制
- ❌ 速度较慢

**UDP 特点**：
- ✅ 速度快
- ❌ 不可靠
- ❌ 无序

**TCP 三次握手**：
```
客户端 → 服务器：SYN（我要连接）
服务器 → 客户端：SYN-ACK（可以连接）
客户端 → 服务器：ACK（确认连接）
```

**TCP 四次挥手**：
```
客户端 → 服务器：FIN（我要断开）
服务器 → 客户端：ACK（收到）
服务器 → 客户端：FIN（我也断开）
客户端 → 服务器：ACK（确认）
```

---

#### 第 3 层：网络层（Network Layer）

**功能**：
- IP 地址寻址
- 路由选择
- 数据包转发

**协议**：
- **IP**（Internet Protocol）
- ICMP
- ARP

**IP 地址**：
- IPv4：`192.168.1.1`
- IPv6：`2001:0db8:85a3::8a2e:0370:7334`

**路由**：
- 数据包从源 IP 到目标 IP
- 经过多个路由器转发

---

#### 第 2 层：数据链路层（Data Link Layer）

**功能**：
- MAC 地址寻址
- 帧传输
- 错误检测

**协议**：
- Ethernet
- PPP

**MAC 地址**：
- 格式：`00:1B:44:11:3A:B7`
- 硬件地址，全球唯一

**交换机**：
- 工作在数据链路层
- 根据 MAC 地址转发数据

---

#### 第 1 层：物理层（Physical Layer）

**功能**：
- 传输比特流
- 物理介质（电缆、光纤）

**设备**：
- 网线
- 光纤
- 无线信号

---

## 二、TCP/IP 四层模型

### 2.1 模型概览

```
应用层（Application Layer）
    ↓
传输层（Transport Layer）
    ↓
网络层（Internet Layer）
    ↓
链路层（Link Layer）
```

### 2.2 与 OSI 对应关系

| TCP/IP 四层 | OSI 七层 | 说明 |
|------------|---------|------|
| **应用层** | 应用层 + 表示层 + 会话层 | HTTP、HTTPS、FTP、DNS |
| **传输层** | 传输层 | TCP、UDP |
| **网络层** | 网络层 | IP、ICMP |
| **链路层** | 数据链路层 + 物理层 | Ethernet、WiFi |

### 2.3 各层详解

#### 应用层

**协议**：
- HTTP / HTTPS
- FTP
- SMTP
- DNS

**特点**：
- 直接为用户提供服务
- 包含 OSI 的应用层、表示层、会话层

---

#### 传输层

**协议**：
- TCP（可靠传输）
- UDP（快速传输）

**端口号**：
- HTTP：80
- HTTPS：443
- FTP：21
- SSH：22

---

#### 网络层

**协议**：
- IP（Internet Protocol）
- ICMP（错误报告）
- ARP（地址解析）

**IP 地址**：
- 标识网络中的设备
- 路由选择依据

---

#### 链路层

**协议**：
- Ethernet
- WiFi
- PPP

**MAC 地址**：
- 硬件地址
- 局域网内通信

---

## 三、模型对比

### 3.1 OSI vs TCP/IP

| 特性 | OSI 七层 | TCP/IP 四层 |
|------|---------|------------|
| **分层** | 7 层（理论模型） | 4 层（实际应用） |
| **复杂度** | 较复杂 | 较简单 |
| **应用** | 教学、理论分析 | 实际网络协议 |
| **对应关系** | 标准模型 | 简化模型 |

### 3.2 数据封装过程

```
应用层数据
    ↓
+ TCP 头（传输层）
    ↓
+ IP 头（网络层）
    ↓
+ MAC 头（链路层）
    ↓
物理层传输
```

---

## 四、浏览器请求流程

### 4.1 完整流程

```
1. 应用层：HTTP 请求
   GET /index.html HTTP/1.1
   
2. 传输层：TCP 封装
   + TCP 头（端口号：80）
   
3. 网络层：IP 封装
   + IP 头（源 IP、目标 IP）
   
4. 链路层：MAC 封装
   + MAC 头（源 MAC、目标 MAC）
   
5. 物理层：比特流传输
   通过网线/光纤传输
   
6. 服务器接收（反向过程）
   物理层 → 链路层 → 网络层 → 传输层 → 应用层
```

### 4.2 数据流

**浏览器 → 服务器**：
```
浏览器 HTTP 请求 
  → TCP/IP 栈 
  → 物理介质 
  → 服务器 TCP/IP 栈 
  → HTTP 处理
```

**服务器 → 浏览器**：
```
服务器 HTTP 响应 
  → TCP/IP 栈 
  → 物理介质 
  → 浏览器 TCP/IP 栈 
  → 页面渲染
```

---

## 五、面试常考点

### 5.1 TCP 三次握手

**问题**：为什么是三次握手，不是两次或四次？

**答案**：
- **两次不够**：无法确认客户端收到服务器的响应
- **三次足够**：双方都确认了连接建立
- **四次多余**：三次已经足够建立可靠连接

### 5.2 TCP vs UDP

**问题**：TCP 和 UDP 的区别？

**答案**：

| 特性 | TCP | UDP |
|------|-----|-----|
| **可靠性** | 可靠 | 不可靠 |
| **连接** | 面向连接 | 无连接 |
| **速度** | 较慢 | 较快 |
| **应用** | HTTP、FTP | DNS、视频流 |

### 5.3 IP 与 MAC 地址

**问题**：IP 地址和 MAC 地址的区别？

**答案**：
- **IP 地址**：逻辑地址，网络层，可以改变
- **MAC 地址**：物理地址，链路层，全球唯一，不可改变

### 5.4 HTTPS 工作层级

**问题**：HTTPS 在哪一层工作？

**答案**：
- **TLS/SSL**：工作在表示层（OSI 6层）
- **HTTP**：工作在应用层（OSI 7层）
- **实际**：TCP/IP 模型中，TLS 在应用层和传输层之间

---

## 🎯 学习建议

1. **理解分层**：掌握每层的功能和协议
2. **对比模型**：理解 OSI 和 TCP/IP 的对应关系
3. **实际应用**：结合浏览器请求流程理解
4. **面试准备**：重点掌握 TCP、IP、HTTP 相关知识点

---

## 📖 相关资源

- [MDN: HTTP 概述](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Overview)
- [TCP/IP 协议详解](https://www.rfc-editor.org/rfc/rfc793)

---

**相关文件**：
- [http_diff.md](./http_diff.md) - HTTP 版本差异
- [http_html_render.md](./http_html_render.md) - 浏览器渲染机制
